---
title: "[프로그래머스] 특정 기간동안 대여 가능한 자동차들의 대여비용 구하기 - SQL"
date: 2025-01-06  
categories: [코딩테스트 연습, SQL코테]
tags: [SQL, GROUP BY]
layout: post
author: mongblang
---

# 📌&nbsp; **프로그래머스 SQL 고득점 Kit - JOIN 문제 7**
[문제 링크](https://school.programmers.co.kr/learn/courses/30/lessons/157339)  

# 📝&nbsp; **문제**
---
![problem](/assets/img/codingtest-post-img/PGSQL_join7-1.png)
![problem2](/assets/img/codingtest-post-img/PGSQL_join7-2.png)
![problem3](/assets/img/codingtest-post-img/PGSQL_join7-3.png)



## **내 풀이**  
---  

```sql
SELECT A.CAR_ID, A.CAR_TYPE, FLOOR((A.DAILY_FEE * 30 * (100-COALESCE(B.DISCOUNT_RATE,0))/100)) AS FEE
FROM CAR_RENTAL_COMPANY_CAR A LEFT OUTER JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN B ON A.CAR_TYPE = B.CAR_TYPE AND B.DURATION_TYPE = '30일 이상'
WHERE (A.CAR_TYPE IN ('세단','SUV')) 
AND (A.CAR_ID NOT IN (SELECT CAR_ID
                  FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
                  WHERE START_DATE <= '2022-11-30'
                  AND END_DATE >= '2022-11-01'))
AND (FLOOR((A.DAILY_FEE * 30 * (100-COALESCE(B.DISCOUNT_RATE,0))/100)) >= 500000)
AND (FLOOR((A.DAILY_FEE * 30 * (100-COALESCE(B.DISCOUNT_RATE,0))/100)) < 2000000)
ORDER BY FEE DESC, A.CAR_TYPE ASC, A.CAR_ID DESC
```

#### **코드 해설**
1. 할인 정책이 없는 차량이 있는 경우를 대비해 차량 테이블과 할인 테이블을 left 조인을 한다. 조인 조건은 차량 종류와 대여기간 종류가 30일 이상으로 설정한다. 
2. where 절에 첫번째 조건으로 차량 종류가 세단이거나 SUV인 데이터를 IN을 사용해 필터링한다. 
3. 두 번째 조건은 서브쿼리로 대여 기록 테이블에서 대여기간이 11월 1일부터 30일 사이에 있는 차량을 제외한다. 
4. 마지막으로 `일일 대여요금 * 30일 * 100%-할인율`이 50만원 이상 200만원 이하인 차량들만 필터링하는데, NULL인 데이터는 COALESCE함수로 처리한다. 그리고 정수형으로 반환하기 위해 FLOOR함수를 사용한다.
5. 순차적으로 대여 금액을 기준으로 내림차순 -> 차량 종류 오름차순 -> 차량ID 내림차순 정렬을 적용한 후 차량ID와 대여 금액을 FEE라는 컬럼으로 반환한다. 

&nbsp;   

