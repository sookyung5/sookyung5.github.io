---
title: "[프로그래머스] 상품을 구매한 회원 비율 구하기 - SQL"
date: 2025-01-12  
categories: [코딩테스트 연습, SQL코테]
tags: [SQL, GROUP BY]
layout: post
author: mongblang
---

# 📌&nbsp; **프로그래머스 SQL 고득점 Kit - JOIN 문제 12**
[문제 링크](https://school.programmers.co.kr/learn/courses/30/lessons/131534)  

# 📝&nbsp; **문제**
---
![problem](/assets/img/codingtest-post-img/PGSQL_join12-1.png)
![problem2](/assets/img/codingtest-post-img/PGSQL_join12-2.png)


## ✏️&nbsp; **입출력 예시**
---
![problem3](/assets/img/codingtest-post-img/PGSQL_join12-3.png)
![problem4](/assets/img/codingtest-post-img/PGSQL_join12-4.png)
![problem5](/assets/img/codingtest-post-img/PGSQL_join12-5.png)



&nbsp;  

&nbsp;   

## **내 풀이**  
---  

```sql
SELECT YEAR(B.SALES_DATE) AS YEAR, MONTH(B.SALES_DATE) AS MONTH,
        COUNT(DISTINCT A.USER_ID) AS PURCHASED_USERS,
        ROUND(COUNT(DISTINCT A.USER_ID)/ 
               (SELECT COUNT(DISTINCT USER_ID) FROM USER_INFO 
                WHERE YEAR(JOINED)='2021'),1) AS PURCHASED_RATIO
FROM USER_INFO A JOIN ONLINE_SALE B ON A.USER_ID = B.USER_ID
WHERE YEAR(A.JOINED) = '2021'
GROUP BY YEAR(B.SALES_DATE), MONTH(B.SALES_DATE)
ORDER BY YEAR, MONTH
```

#### **코드 해설**
1. 사용자 정보 테이블과 판매 정보 테이블을 user_ID를 기준으로 이너조인 하고, 가입 년도가 2021년이면서 구매이력이 있는 사용자의 정보만 필터링한다.
2. 상품을 구매한 회원의 비율을 년, 월별로 조회하기 위해 판매 정보 테이블의 판매일에서 년도와 월을 추출해 각각 그룹화한다.
3. 연, 월과 구매이력이 있는 고객의 수(unique) 그리고 구매이력이 있는 고객의 수를 2021년에 가입한 전체 고객으로 나눈 값을 소수점 2자리에서 반올림 해 비율을 계산한다.  이때, 스칼라 서브쿼리를 활용해 가입년도가 2021년인 고객의 수를 구해 분모로 설정하고, 분자는 purchased_users를 구할 때 사용한 값을 그대로 사용한다. 
5. 마지막으로 년, 월을 기준으로 오름차순 정렬한다. 


&nbsp;   

